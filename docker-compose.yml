services:
 task-list:
   build:
    context: .
   ports:
    - 8080:8080
   networks:
    - task-list-network
   environment:
    SPRING_PROFILES_ACTIVE: ${PROFILES_ACTIVE}
    MYSQL_HOST: task-list-db
    MYSQL_USERNAME: ${MYSQL_USERNAME}
    MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    MYSQL_DATABASE: tasklist
    ALLOWED_ORIGINS: ${ALLOWED_ORIGINS}
    SERVER_PORT: ${SERVER_PORT:-8080}
    APP_JWT_ISSUER: ${APP_JWT_ISSUER:-tasklist}
    APP_JWT_ACCESS_DURATION: ${APP_JWT_ACCESS_DURATION:-1h}
    APP_JWT_REFRESH_DURATION: ${APP_JWT_REFRESH_DURATION:-24h}
    COOKIE_SECURE: ${COOKIE_SECURE:-false}
    MAIL_HOST: ${MAIL_HOST}
    MAIL_PORT: ${MAIL_PORT}
    MAIL_USERNAME: ${MAIL_USERNAME}
    MAIL_PASSWORD: ${MAIL_PASSWORD}
    MAIL_PROTOCOL: ${MAIL_PROTOCOL:-smtp}
    MAIL_TTLS_ENABLE: ${MAIL_TTLS_ENABLE:-true}
    MAIL_CONNECTION_TIMEOUT: ${MAIL_CONNECTION_TIMEOUT:-5000}
    MAIL_TIMEOUT: ${MAIL_TIMEOUT:-5000}
    MAIL_WRITE_TIMEOUT: ${MAIL_WRITE_TIMEOUT:-10000}
   restart: on-failure
   depends_on:
    - task-list-db
   command: ["./wait-for-it.sh", "task-list-db:3306", "--timeout=300", "--strict", "java", "-jar", "/opt/app/task-list.jar"]

 task-list-db:
  image: mysql:8.0
  networks:
   - task-list-network
  ports:
   - 3306:3306
  volumes:
   - task-list-mysql-data:/var/lib/mysql
  environment:
   MYSQL_USER: ${MYSQL_USERNAME}
   MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
   MYSQL_PASSWORD: ${MYSQL_PASSWORD}
   MYSQL_DATABASE: tasklist   

networks:
 task-list-network:
volumes:
 task-list-mysql-data:
