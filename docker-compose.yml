services:
 task-list:
   build:
    context: .
   ports:
    - 8080:8080
   networks:
    - task-list-network
   environment:
    MYSQL_HOST: task-list-db
    MYSQL_USERNAME: ${MYSQL_USERNAME}
    MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    MYSQL_DATABASE: tasklist
    ALLOWED_ORIGINS: ${ALLOWED_ORIGINS}
    SERVER_PORT: ${SERVER_PORT:-8080}
    APP_JWT_ISSUER: ${APP_JWT_ISSUER:-tasklist}
    APP_JWT_KEY: ${APP_JWT_KEY:-tasklist}
    APP_JWT_DURATION: ${APP_JWT_DURATION:-24h}
   restart: on-failure
   depends_on:
    - task-list-db
   command: ["./wait-for-it.sh", "task-list-db:3306", "--timeout=300", "--strict", "java", "-jar", "/opt/app/task-list.jar"]

 task-list-db:
  image: mysql:8.0
  networks:
   - task-list-network
  ports:
   - 3306:3306
  volumes:
   - task-list-mysql-data:/var/lib/mysql
  environment:
   MYSQL_USER: ${MYSQL_USERNAME}
   MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
   MYSQL_PASSWORD: ${MYSQL_PASSWORD}
   MYSQL_DATABASE: tasklist   

networks:
 task-list-network:
volumes:
 task-list-mysql-data:
